---
output:
  md_document:
    variant: markdown_github
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# Rvoteview

**WARNING: This package is under construction. The server and database are currently being revamped. Some features may break. please limit the number of roll calls you request at a time and be prepared for queries to break or behave strangely.**

This is a package that enables you to query the Voteview database for roll calls and work with data frames or a `pscl` `rollcall` object.

To install this package, ensure you have `devtools` installed. If you do not, run `install.packages("devtools")` before doing the following:
```R
devtools::install_github("JeffreyBLewis/Rvoteview")
```

For more thorough documentation, see the help files for individual functions and the vignette [at this link here](https://github.com/JeffreyBLewis/Rvoteview/tree/master/vignettes).

## Using Rvoteview

To use `Rvoteview`, you generally want to query the database to get a list of vote ids and then use those to return the individual votes. We query the database with a search term and some parameters to constrain the search. For now we take a string that will seach for a bill that has ANY of the words in the string in ANY text field. Additional boolean and targeted searches have been implemented and can be found in the vignette.
```{r search}
library(Rvoteview)
  
res <- voteview_search("Iraq")
names(res)
  
## I will drop description since it is a very long field
head(res[, -1])
```
Using `res$id` we can get a `rollcall` object (from the [`pscl` package](https://cran.r-project.org/web/packages/pscl/index.html)) that contains the full set of votes and data for each roll call. 

```{r download, results='hide'}
## Get a rollcall object using the ids, please limit to a few ids for now!
rc <- voteview_download(res$id[1:10])
```
```{r pscl-sum}
## Now this object can be used in many 'pscl' methods
summary(rc)
```

We have also begun extending the `pscl` `rollcall` object by allowing you to do a full outer join on two `rollcall` objects that were built using this package. For example:

```{r download2, results='hide'}
rc2 <- voteview_download(res$id[c(5, 100)])
```
```{r pscl-add}
## Now we can merge this with 'rc'
rcAll <- rc %+% rc2

rc$m
rc2$m
rcAll$m # rc$m + rc2$m - 1 because of the one vote overlap
```

You can also search by start and end date, congress, and chamber. Please see the help files for each function after you install the package to see a little more about how they work.

```{r search-options}
## Voteview search with options
res <- voteview_search("Iraq", chamber = "House", congress = 110,
                       startdate = 2008, enddate = "2008-04-20")
head(res[, -1])

res <- voteview_search("Iraq", congress = 109:112)
head(res[, -1])
```

We can also build complex queries manually.

```{r search-adv}
## Voteview search with options
res <- voteview_search("(alltext:estate death tax congress:[100 to 114])")
head(res[, -1])
tail(res[, -1])
```

